{
  "hash": "e553e73d15ed20297825483bbb257e12",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"G-computation in NZAVS Studies\"\nexecute:\n  warning: false\n  echo: false\ndraft: false\ncitation:\n  url: https://go-bayes.github.io/b-causal/\ndate: 2022-11-05\nimage: \"gc.png\"\nauthor: \n  - name: Joseph Bulbulia\n    orcid: 0000-0002-5861-2056\n    affiliation: Victoria University of Wellington, New Zealand\n    email: joseph.bulbulia@vuw.ac.nz\n    corresponding: yes\ndate-format: short\nbibliography: references.bib\ncategories: \n  - Causal Inference\n  - NZAVS\n  - Methods\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## Causal Inference\n\nSuppose we want to infer whether a binary exposure has a causal effect. We must answer three questions:\n\n1. What would happen with exposure?\n2. What would happen without exposure?\n3. Do these potential outcomes differ?\n\nConsider a binary exposure $A$ with two levels, $A = 0$ and $A = 1$ and a continuous outcome $Y$. Estimating the causal effect of $A$ on outcome $Y$ requires contrasting two counterfactual states of the world: the state $Y^{a=1}$ when, hypothetically, $A$ is set to $1$ and the state $Y^{a=0}$ when, hypothetically, $A$ is set to $0$. We say that $A$ affects $Y$ when the quantities $Y^{a=1} - Y^{a=0} \\neq 0$ [@hernan2023].\n\n### The Fundamental Problem of Causal Inference\n\nAt any given time, for any individual, at most only one level of the exposure $A$ may be realised. That is, $Y^{a=1}$ and $Y^{a=0}$ are never simultaneously observed for any individual. As such, individual-level causal effects are not typically identifiable in the data. This is referred to as \"the fundamental problem of causal inference\" [@rubin1976; @gelman2020a]. $Y^{a=1}$ and $Y^{a=0}$ are therefore called \"potential\" or \"counterfactual\" outcomes.\n\nAlthough we generally cannot observe individual causal effects, when certain assumptions are satisfied, we may identify the average or marginal causal effect at the population level. We say there is an average or marginal causal effect if the difference of the means of those who are exposed and not exposed does not equal zero: $E(Y^{a=1}) - E(Y^{a=0})\\neq 0$. Because the difference of the means is equivalent to the mean of the differences, we may equivalently say there is a marginal causal effect if $E(Y^{a=1} - Y^{a=0})\\neq 0$ [@hernan2023]. \n\nTo ensure valid inference, the potential outcomes must be conditionally independent of the exposure:\n\n$$Y^a \\perp\\!\\!\\!\\perp A|L$$\n\nOutside of controlled experiments, we cannot typically ensure this conditional independence. For this reason, we use sensitivity analysis, such as the *E-value* [@vanderweele2020].\n\n## G-Computation\n\n\n### What is G-Computation?\nG-computation, sometimes called \"regression standardisation\" is a non-parametric method for estimating causal effects from observational data in the presence of confounding variables. It was introduced by James Robins in 1986 and is based on the potential outcomes framework. G-computation allows for estimating the causal effects of time-varying treatments and can handle complex treatment regimens and effect modification. \n\n\n### How Does G-Computation Work?\n\nTo consistently estimate a causal association from statistical associations in the data, we must infer the average outcomes for the entire population were it subject to different levels of the exposure variable $A = a$ and $A=a^*$. The average treatment effect (ATE) can be expressed as:\n\n$$ATE = E[Y^{a^*}] - E[Y^a] = \\sum_l E[Y|A=a^*, L=l]\\Pr[L=l] - \\sum_l E[Y|A=a, L=l]\\Pr[L=l]$$\n\nHowever, we need not estimate $\\Pr(L = l)$ directly. Instead, we can obtain the weighted mean for the distribution of the confounders in the data by taking the double expectation: [@hernan2023, p.166].\n\n$$ATE = E[E(Y|A = a, \\boldsymbol{L}) - E(Y|A = a^*, \\boldsymbol{L})]$$\n\n\nStep 1. Fit a regression for the outcome on the exposure $A_{t0}$ and baseline covariates $\\boldsymbol{L} = (L_1, L_2,L_3 \\dots L_n)$. To avoid making unjustified linearity assumptions, model the relationship between the exposure and each of the potential outcomes of interest using a cubic spline. Include in the set of baseline confounders $\\boldsymbol{L}$, the baseline measure of the exposure as well as the baseline responses:\n\n   $$\\{A_{t-1}, \\boldsymbol{Y_{t-1}} = (Y_{1, t-1}, Y_{2, t-1}, Y_{3, t-1}\\dots Y_{n, t-1})\\} \\subset \\boldsymbol{L}$$\n\n   This provides\n\n   $$E(Y|A, \\boldsymbol{L})$$\n\nStep 2. Use the model from step 1 to predict the values of a potential outcome $Y^{a}$ by setting the exposure to the value $A = a$.\n\n   This provides\n\n   $$\\hat{E}(Y|A = a, \\boldsymbol{L})$$\n\nStep 3. Use the model from step 1 to predict the values of a different potential outcome $Y^{a*}$ by setting the exposure to a different value of $A = a^{\\star}$.\n\n   This provides\n\n   $$\\hat{E}(Y|A = a^*, \\boldsymbol{L})$$\n\nStep 4. Obtain the focal contrast as the expected difference in the average outcomes when exposure is at levels $a*$ and $a$. For continuous outcomes, calculate the mean of $Y^a$ and the mean of $Y^{a*}$ and then find their difference. This provides:\n\n   $$\\hat{ATE} = \\hat{E}[\\hat{E}(Y|A = a, \\boldsymbol{L}) - \\hat{E}(Y|A = a^*, \\boldsymbol{L})]$$\n\nStep 5. For binary outcomes, calculate the causal risk ratio in moving between different levels of A. When binary outcomes are more common than 10%, use a log-normal model to calculate a causal rate ratio [@vanderweele2020].\n\nStep 6. The `stdReg` package in R calculates standard errors using the Delta method, from which we construct confidence intervals under asymptotic assumptions [@sjölander2016]. Additionally, we pool uncertainty arising from the multiple imputation procedure by employing Rubin's Rules.\n\nStep 7. Finally, we perform sensitivity analyses to assess the sensitivity of the causal effect estimates to modelling assumptions.\n\n\n## What are the assumptions of g-computation? \n\n\n1. **Outcome Model Misspecification**: G-computation's performance depends on the correct specification of the outcome model. If the model is misspecified, g-computation can produce biased estimates of the ATE.\n\n2. **Confounding**: G-computation relies on the assumption that there are no unmeasured confounders. If this assumption is violated, the estimates can be biased.\n\n\n\n## Applications\n\nSee upcoming \"Outcome-wide science\" reports for illustrations of how we apply G-computation to NZAVS studies.\n\n### Acknowledgements\n\nWe are grateful to Arvid Sjölander for his help in modifying his stdReg package in R to enable G-computation with multiply-imputed datasets.\n\nFor a simple visual guide to G-computation see [Kat Hoffman's blog](https://www.khstats.com/art/illustrations_viz.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}